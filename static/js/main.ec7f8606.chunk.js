(this.webpackJsonpeffects=this.webpackJsonpeffects||[]).push([[0],[,,,,,,,,function(e,t,i){},,function(e,t,i){e.exports=i.p+"static/media/Toha.c4ee0dc2.jpg"},function(e,t,i){e.exports=i.p+"static/media/Toha-map.1ca325a7.jpg"},function(e,t,i){e.exports=i(17)},,,,,function(e,t,i){"use strict";i.r(t);var n=i(0),r=i.n(n),a=i(9),o=i.n(a),s=(i(8),i(1)),h=i(2),u=i(5),c=i(4),m=i(6),l=i(3),g=i.n(l),d="#ifdef GL_ES\n  precision mediump float;\n#define GLSLIFY 1\n#endif\n\nuniform vec4 resolution;\nuniform vec2 mouse;\nuniform vec2 threshold;\nuniform float time;\nuniform float pixelRatio;\nuniform sampler2D image0;\nuniform sampler2D image1;\n\nvec2 mirrored(vec2 v) {\n  vec2 m = mod(v,2.);\n  return mix(m,2.0 - m, step(1.0 ,m));\n}\n\nvoid main() {\n  // uvs and textures\n  vec2 uv = pixelRatio*gl_FragCoord.xy / resolution.xy ;\n  vec2 vUv = (uv - vec2(0.5))*resolution.zw + vec2(0.5);\n  vUv.y = 1. - vUv.y;\n  vec4 tex1 = texture2D(image1,mirrored(vUv));\n  vec2 fake3d = vec2(vUv.x + (tex1.r - 0.5)*mouse.x/threshold.x, vUv.y + (tex1.r - 0.5)*mouse.y/threshold.y);\n  gl_FragColor = texture2D(image0,mirrored(fake3d));\n}",v="#define GLSLIFY 1\nattribute vec2 a_position;\n\nvoid main() {\n  gl_Position = vec4( a_position, 0, 1 );\n}",f=function(e,t){var i=e.map(function(e){return new Promise(function(t){return function(e,t){var i=new Image;i.src=e,i.onload=function(){return t(i)}}(e,t)})});Promise.all(i).then(function(e){return t(e)})},p=function(e,t,i,n){this.name=e,this.suffix=t,this.gl=n,this.program=i,this.location=n.getUniformLocation(i,e)};p.prototype.set=function(){for(var e="uniform"+this.suffix,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=[this.location].concat(i);this.gl[e].apply(this.gl,r)};var T=function e(t){var i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e.verts,t.STATIC_DRAW)};T.verts=new Float32Array([-1,-1,1,-1,-1,1,1,1]),T.prototype.render=function(e){e.drawArrays(e.TRIANGLE_STRIP,0,4)};var w=function(e,t,i){return e===e&&(void 0!==i&&(e=e<=i?e:i),void 0!==t&&(e=e>=t?e:t)),e};console.log(g.a);new g.a;var E=i(10),R=i.n(E),x=i(11),_=i.n(x),y=new g.a,A=function(e){function t(e){var i;return Object(s.a)(this,t),(i=Object(u.a)(this,Object(c.a)(t).call(this,e))).resizeHandler=function(){var e,t;i.windowWidth=window.innerWidth,i.windowHeight=window.innerHeight,i.width=i.container.current.offsetWidth,i.height=i.container.current.offsetHeight,i.canvas.width=i.width*i.ratio,i.canvas.height=i.height*i.ratio,i.canvas.style.width=i.width+"px",i.canvas.style.height=i.height+"px",i.height/i.width<i.imageAspect?(e=1,t=i.height/i.width/i.imageAspect):(e=i.width/i.height*i.imageAspect,t=1),i.uResolution.set(i.width,i.height,e,t),i.uRatio.set(1/i.ratio),i.uThreshold.set(i.hth,i.vth),i.gl.viewport(0,0,i.width*i.ratio,i.height*i.ratio)},i.onMouseMove=function(e){var t=i.windowWidth/2,n=i.windowHeight/2;i.mouseTargetX=(t-e.clientX)/t,i.mouseTargetY=(n-e.clientY)/n},i.container=r.a.createRef(),i}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.canvas=document.createElement("canvas"),this.container.current.appendChild(this.canvas),this.gl=this.canvas.getContext("webgl"),this.ratio=window.devicePixelRatio,this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.mouseX=0,this.mouseY=0,this.mouseTargetX=0,this.mouseTargetY=0,this.imageOriginal=this.props.main,this.imageDepth=this.props.map,this.vth=15,this.hth=35,this.imageURLs=[this.imageOriginal,this.imageDepth],this.textures=[],this.startTime=(new Date).getTime(),document.addEventListener("mousemove",this.onMouseMove),window.addEventListener("resize",this.resizeHandler),this.createScene(),this.addTexture(),this.gyro()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("resize",this.resizeHandler)}},{key:"addShader",value:function(e,t){var i=this.gl.createShader(t);if(this.gl.shaderSource(i,e),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))throw new Error("Shader compile error: "+this.gl.getShaderInfoLog(i));this.gl.attachShader(this.program,i)}},{key:"resize",value:function(){this.resizeHandler()}},{key:"createScene",value:function(){this.program=this.gl.createProgram(),this.addShader(v,this.gl.VERTEX_SHADER),this.addShader(d,this.gl.FRAGMENT_SHADER),this.gl.linkProgram(this.program),this.gl.useProgram(this.program),this.uResolution=new p("resolution","4f",this.program,this.gl),this.uMouse=new p("mouse","2f",this.program,this.gl),this.uTime=new p("time","1f",this.program,this.gl),this.uRatio=new p("pixelRatio","1f",this.program,this.gl),this.uThreshold=new p("threshold","2f",this.program,this.gl),this.billboard=new T(this.gl),this.positionLocation=this.gl.getAttribLocation(this.program,"a_position"),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0)}},{key:"addTexture",value:function(){this.gl;f(this.imageURLs,this.start.bind(this))}},{key:"start",value:function(e){var t=this.gl;this.imageAspect=e[0].naturalHeight/e[0].naturalWidth;for(var i=0;i<e.length;i++){var n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e[i]),this.textures.push(n)}var r=this.gl.getUniformLocation(this.program,"image0"),a=this.gl.getUniformLocation(this.program,"image1");this.gl.uniform1i(r,0),this.gl.uniform1i(a,1),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[0]),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[1]),this.resize(),this.renderCanvas()}},{key:"gyro",value:function(){y.init({gravityNormalized:!0}).then(function(){y.start(function(e){var t=e.do.gamma,i=e.do.beta;this.mouseTargetY=w(i,-15,15)/15,this.mouseTargetX=-w(t,-15,15)/15})}).catch(function(e){console.log(e)})}},{key:"renderCanvas",value:function(){var e=((new Date).getTime()-this.startTime)/1e3;this.uTime.set(e),this.mouseX+=.05*(this.mouseTargetX-this.mouseX),this.mouseY+=.05*(this.mouseTargetY-this.mouseY),this.uMouse.set(this.mouseX,this.mouseY),this.billboard.render(this.gl),requestAnimationFrame(this.renderCanvas.bind(this))}},{key:"render",value:function(){return r.a.createElement("div",{ref:this.container,className:"img-container"})}}]),t}(r.a.Component),b=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"frame"},r.a.createElement(A,{main:R.a,map:_.a})))}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(b,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[12,1,2]]]);
//# sourceMappingURL=main.ec7f8606.chunk.js.map